<grid-main>
  <app-page-subtitle [subtitle]="title"></app-page-subtitle>
  <div class="tab-slider--nav">
    <ul class="tab-slider--tabs">

      <mat-icon class="files-theme" [class.active]="viewMode === 'tab1'" rel="tab1"
      (click)="onChangeType('import', 'tab1')" matTooltip="Upload using local file">upload_file</mat-icon>
      <mat-icon class="files-theme" [class.active]="viewMode === 'tab2'" rel="tab2"
      (click)="onChangeType('url', 'tab2')" matTooltip="Upload using link">insert_link</mat-icon>
    </ul>
  </div>
  <div class="tab-slider--container">
    @switch (viewMode) {
      @case ('tab1') {
        <div id="tab1" class="tab-slider--body">
          <h4>Upload from your computer</h4>
          <form [formGroup]="form" fxLayout="column">
            <input-select title="Access group" formControlName="accessGroupId" [items]="selectAccessgroup"
            [isRequired]="true"></input-select>
            <div fxLayout="row" fxLayoutGap="10px">
              <input-file formControlName="sourceData" (filesSelected)="onFilesSelected($event)"></input-file>
              @if (redirect === 'wordlist') {
                <div>
                  <button mat-icon-button (click)="showHelp()" matTooltip="Simple Wordlist Generator">
                    <mat-icon>build_circle</mat-icon>
                  </button>
                </div>
              }
            </div>
            @if (uploadProgress > 0) {
              <div>
                <ngb-progressbar type="success" textType="white" [striped]="true" [value]="uploadProgress"
                [showValue]="true"></ngb-progressbar>
              </div>
            }
            @if (uploadProgress === 100) {
              <div>
                <p><b>Upload completed!</b></p>
              </div>
            }
            <input-check title="Secret Data" formControlName="isSecret"></input-check>
            <grid-buttons fxLayout="row" fxLayoutAlign="space-between" fxLayoutGap="10px">
              <button-submit name="Cancel" [disabled]="false" type="cancel"></button-submit>
              <button-submit [name]="'Create'" (click)="onuploadFile(selectedFiles);" data-testid="button-submit-upload"></button-submit>
              @if (isCreatingLoading) {
                <div>
                  <mat-spinner diameter="24" color="accent"></mat-spinner>
                </div>
              }
            </grid-buttons>
          </form>
          <fixed-alert message="Do not refresh the page while uploading"></fixed-alert>
        </div>
      }
      @case ('tab2') {
        <div id="tab2" class="tab-slider--body">
          <h4>Upload to the server using a public/private link</h4>
          <form [formGroup]="form" (ngSubmit)="onSubmit()" fxLayout="column">
            <input-text title="Name" formControlName="filename" [isRequired]="true"></input-text>
            <input-select title="Access group" formControlName="accessGroupId" [items]="selectAccessgroup"></input-select>
            <!--TODO also add ftp to pattern  -->
            <input-text title="URL path" formControlName="url"
              pattern="^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$"
            [isRequired]="true"></input-text>
            <input-check title="Secret Data" formControlName="isSecret"></input-check>
            <grid-buttons>
              <button-submit name="Cancel" [disabled]="false" type="cancel"></button-submit>
              <button-submit [name]="'Create'" [disabled]="!form.valid"></button-submit>
              @if (isCreatingLoading) {
                <div>
                  <mat-spinner diameter="24" color="accent"></mat-spinner>
                </div>
              }
            </grid-buttons>
          </form>
        </div>
      }
    }
  </div>
</grid-main>