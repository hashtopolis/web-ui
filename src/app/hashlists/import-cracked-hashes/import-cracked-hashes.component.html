<div class="row g-3">
  <div class="col-md-7">
    @if (!isLoading) {
      <grid-main>
        <app-page-title
          [title]="type === 3 ? 'SuperHashlist details' : 'HashList details'"
          [subbutton]="false"
        ></app-page-title>
        <app-page-subtitle [subtitle]="'Import pre-cracked hashes'"></app-page-subtitle>
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <input-text title="Name" formControlName="name"></input-text>
          <div fxLayout="row" fxLayoutGap="5px">
            <simulate-form-field
              label="Hash Type"
              message="{{ hashtype.id }} - {{ hashtype.description }}"
            ></simulate-form-field>
          </div>
          <div fxLayout="row" fxLayoutGap="5px">
            <input-text title="Hashes" formControlName="hashCount"></input-text>
            <simulate-form-field label="Salted" [message]="form.get('isSalted')?.value ? 'Yes' : 'No'">
            </simulate-form-field>
            <input-text title="Format" formControlName="format"></input-text>
          </div>
          <div fxLayout="row wrap" fxLayoutGap="10px">
            <input-select title="Hash source" formControlName="sourceType" [items]="selectSource"></input-select>
            @if (form.get('isSalted')?.value) {
              <input-text title="Field separator" formControlName="separator"></input-text>
            }
          </div>

          @if (sourceType === 'paste') {
            <div fxLayout="row" fxLayoutGap="1px" style="align-items: flex-start">
              <input-text-area fxFlex="40" style="min-width: 0" title="Hashes" formControlName="hashes"></input-text-area>
              <button
                mat-icon-button
                matTooltip="Be careful! Hashtopolis does NOT check if the precracked hash is correct!"
                type="button"
                >
                <mat-icon color="primary">warning</mat-icon>
              </button>
            </div>
          }

          @if (sourceType === 'upload') {
            <div>
              <input-file formControlName="sourceData" (filesSelected)="onFilesSelected($event)"></input-file>
              @if (uploadProgress > 0) {
                <div>
                  <ngb-progressbar type="success" textType="white" [striped]="true" [value]="uploadProgress" [showValue]="true"></ngb-progressbar>
                </div>
              }
            </div>
          }

          @if (sourceType === 'import') {
            <div>
              @if (isLoadingServerFiles) {
                <p>Loading files from server import directory...</p>
              } @else {
                <input-select
                  title="Server import file"
                  formControlName="sourceData"
                  [items]="serverFileOptions"
                  [isRequired]="true"
                ></input-select>
                @if (serverFileOptions.length === 0) {
                  <fixed-alert message="No files found in the server import directory."></fixed-alert>
                }
              }
            </div>
          }

          @if (sourceType === 'url') {
            <input-text
              title="URL path"
              formControlName="sourceData"
              pattern="^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$"
              [isRequired]="true"
            ></input-text>
          }
          <grid-buttons>
            <button-submit [name]="'Pre-crack hashes'"></button-submit>
            @if (isCreatingLoading) {
              <div>
                <mat-spinner diameter="24" color="accent"></mat-spinner>
              </div>
            }
          </grid-buttons>
        </form>
      </grid-main>
    }
  </div>
</div>
@if (isLoading) {
  <div>
    <p>Loading...</p>
  </div>
}
