@if (isLoading) {
  <div>
    @if (isLoading) {
      <mat-spinner diameter="16" class="spinner"></mat-spinner>
    }
  </div>
} @else {
  <mat-form-field class="custom-chip-grid">
    <mat-label>{{label}}</mat-label>
    <mat-chip-grid
      #chipGridRef
      [(ngModel)]="chipGridValidation"
      #chipGridNgModel="ngModel"
      name="selectedItems"
      [required]="isRequired"
      aria-label="Items selection"
      >
      @for (item of selectedItems; track item) {
        <mat-chip-row (removed)="remove(item)">
          <div matTooltip="{{ item.name }}">
            {{ item.id }}
            <span>{{ item.name?.length > 30 ? (item.name | slice:0:30) + '...' : item.name }}</span>
          </div>
          <button matChipRemove [attr.aria-label]="'remove ' + item">
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip-row>
      }
    </mat-chip-grid>
    <input
      matInput
      #selectInput
      [matChipInputFor]="chipGridRef"
      [matAutocomplete]="auto"
      [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
      (matChipInputTokenEnd)="onInputChipAdd($event)"
      (input)="onSearchInputChange()"
      [(ngModel)]="searchTerm"
      placeholder="{{ placeholder }}"
      />
    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onAutocompleteSelect($event.option.value)">
      @for (item of filteredItems | async; track item) {
        <mat-option [value]="item">
          <span [innerHTML]="updateHighlightedValue(item.id + ' - ' + item.name, searchTerm)"></span>
        </mat-option>
      }
    </mat-autocomplete>
    @if (chipGridValidation.length === 0) {
      <mat-error>
        This field is required.
      </mat-error>
    }
  </mat-form-field>
}

