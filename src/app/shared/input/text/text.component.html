<mat-form-field [ngStyle]="{ width: width }" appearance="outline">
  <mat-label>
    {{ title }}
    @if (tooltip) {
      <mat-icon
        matTooltip="{{ tooltip }}"
        matTooltipPosition="below"
        matTooltipClass="tooltip-custom-style"
        aria-hidden="true"
        >
        info
      </mat-icon>
    }
  </mat-label>

  @if (icon) {
    <mat-icon matPrefix>{{ icon }}</mat-icon>
  }

  <input
    matInput
    [value]="value"
    #inputField
    [type]="resolvedInputType"
    [required]="isRequired"
    [disabled]="disabled"
    [id]="inputId"
    (blur)="onTouched()"
    (input)="onValueChange($event)"
    />

  <!-- Show password toggle if enabled -->
  @if (showPasswordToggle) {
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="emitShowPassword()"
      [attr.aria-label]="passwordIsVisible ? 'Hide password' : 'Show password'"
      [attr.aria-pressed]="passwordIsVisible"
      >
      <mat-icon>{{ passwordIsVisible ? 'visibility' : 'visibility_off' }}</mat-icon>
    </button>
  }

  @if (hint) {
    <mat-hint>{{ hint }}</mat-hint>
  }

  <!-- Error display based on validation state -->
  @if (hasError && errors) {
    <mat-hint class="mat-mdc-form-field-error" style="color: var(--mat-form-field-error-text-color, #f44336);">
      @if (errors['required']) {
        <span>{{ title }} is required</span>
      }
      @if (errors['email']) {
        <span>Please enter a valid {{ title?.toLowerCase() }}</span>
      }
      @if (errors['url']) {
        <span>Please enter a valid {{ title?.toLowerCase() }}</span>
      }
      @if (errors['minlength']) {
        <span>
          Minimum length is {{ errors['minlength'].requiredLength }}
        </span>
      }
      @if (errors['pattern']) {
        <span>
          Please enter a valid {{ title }}
        </span>
      }
      @if (errors['maxlength']) {
        <span>
          Maximum length is {{ errors['maxlength'].requiredLength }}
        </span>
      }
      @if (errors['passwordMismatch']) {
        <span>Passwords do not match</span>
      }
    </mat-hint>
  }

</mat-form-field>
