<mat-form-field [ngStyle]="{ width: width }" appearance="outline">
  <mat-label>
    {{ title }}
    @if (tooltip) {
      <mat-icon
        matTooltip="{{ tooltip }}"
        matTooltipPosition="below"
        matTooltipClass="tooltip-custom-style"
        aria-hidden="true"
        >
        info
      </mat-icon>
    }
  </mat-label>

  @if (icon) {
    <mat-icon matPrefix>{{ icon }}</mat-icon>
  }

  <!-- important: #inputField="ngModel" is required for validation -->
  <input
    matInput
    [(ngModel)]="value"
    #inputField="ngModel"
    [type]="resolvedInputType"
    [email]="inputType === 'email' ? true : null"
    [required]="isRequired"
    [pattern]="pattern"
    [disabled]="disabled"
    [minlength]="minLength"
    [maxlength]="maxLength"
    [id]="inputId"
    (blur)="onTouched()"
    (ngModelChange)="onChange($event)"
    />

  <!-- Show password toggle if enabled -->
  @if (showPasswordToggle) {
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="emitShowPassword()"
      [attr.aria-label]="passwordIsVisible ? 'Hide password' : 'Show password'"
      [attr.aria-pressed]="passwordIsVisible"
      >
      <mat-icon>{{ passwordIsVisible ? 'visibility' : 'visibility_off' }}</mat-icon>
    </button>
  }

  @if (hint) {
    <mat-hint>{{ hint }}</mat-hint>
  }

  <!-- Error display based on native ngModel validation -->
  @if (inputField.errors && (inputField.dirty || inputField.touched)) {
    <mat-error>
      @if (inputField.errors.required) {
        <span>{{ title }} is required</span>
      }
      @if (inputField.errors.email) {
        <span>Please enter a valid {{ title?.toLowerCase() }}</span>
      }
      @if (inputField.errors.url) {
        <span>Please enter a valid {{ title?.toLowerCase() }}</span>
      }
      @if (inputField.errors.minlength) {
        <span>
          Minimum length is {{ inputField.errors.minlength.requiredLength }}
        </span>
      }
      @if (inputField.errors.pattern) {
        <span>
          Please enter a valid {{ title }}
        </span>
      }
      @if (inputField.errors.maxlength) {
        <span>
          Maximum length is {{ inputField.errors.maxlength.requiredLength }}
        </span>
      }
      @if (inputField.errors?.passwordMismatch) {
        <span>Passwords do not match</span>
      }
    </mat-error>
  }

</mat-form-field>
